import sys, time, os
import sqlite3

def analysize(file):
    time.sleep(3)


sha1 = sys.argv[2]
filename = sys.argv[1]


# for file in os.listdir('apk_upload'):
#     path = os.path.join('apk_upload', file)



sqlite_conn=sqlite3.connect('malDetect.db')
sqlite_cursor=sqlite_conn.cursor()
sql_query = "SELECT filename, sha1 from entries"
sqlite_cursor.execute(sql_query)

if sha1 in [row[1] for row in sqlite_cursor]:
    sql_query = "SELECT * from entries WHERE sha1='%s'" %sha1
    sqlite_cursor.execute(sql_query)
    for row in sqlite_cursor:
        print row[1], row[2], row[3], row[4], row[5], row[6]
        break

else:
    for li in os.listdir('apk_upload'):
        new_name = filename.split('.')[0]+'_'+sha1+'.'+filename.split('.')[-1]
        if new_name == li:
            file = os.path.join('apk_upload', li)
            filesize = round(os.path.getsize(file) / 1000000.0, 1)
            sql_insert="INSERT INTO entries(filename, sha1, filesize, probility, permission, APIs) values(?, ?, ?, ?, ?, ?);"
            sqlite_cursor.execute(sql_insert, [filename, sha1, str(filesize)+'MB', '0.92', 'SEND_SMS,RECEIVE_SMS', 'ContentResolver->query,ContentService->dump,ActivityManager->restartPackage'])
            sqlite_conn.commit()

            xxx = analysize(file)
            print filename, sha1, str(filesize) + 'MB', '0.82', 'SEND_SMS,RECEIVE_SMS', 'ContentResolver->query,ContentService->dump,ActivityManager->restartPackage', 'xx'
            break


